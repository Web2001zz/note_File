# nodeJs

## 谈谈浏览器的事件轮询与nodejs的事件轮询机制
  - 浏览器的事件轮询机制
      - 首先，浏览器分为几个线程
          - JS引擎线程：解释执行JS代码、用户输入、网络请求等
          - GUI线程：绘制用户界面、与js主线程是互斥的
          - http网络请求线程：用于处理用户的get和post请求，等返回结果后将回调函数推入任务队列
          - 定时器触发线程：setTimeout、setInterval等待时间结束后把执行函数推入任务队列
          - 浏览器事件处理线程：将click等交互事件发生后放入到事件队列中
      - js是通过事件轮询机制实现JS单线程的异步操作
      - event loop 就是实现异步回调的原理
      - 当JS主线程执行完毕，会进入到任务队列执行settimeout等代码
  - 任务队列内部又分微任务和宏任务
    - 微任务会先于宏任务执行
    - 微任务全部执行完成后执行宏任务，每次执行宏任务的时候都会进行一次循环看看是否有新的微任务添加进来，如果有则会立即执行
    - 宏任务与微任务
      - 微任务主要有nextTick、promise的then、catch、
      - 宏任务有以下执行队列
        - timers ： 执行计时器的回调函数
        - pending callbacks：执行某些操作系统的回调函数
        - idle：执行准备工作
        - poll：轮询阶段，此阶段会回去轮询队列，依次同步取出轮询队列中的第一个回调执行，直到轮询队列为空
          - 如果之前设置过setimmediate函数则会直接进入到下一个阶段，如果没有设置则会在当前阶段等待，直到轮询队列添加了回调函数，会第一个执行他，如果定时器到点了则会去到下一个阶段
        - check：执行setimmediate设置的回调函数
        - close 关闭阶段